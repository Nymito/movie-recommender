<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Recommender — Movies</title>
    <style>
        :root{
            --bg:#0b0b0f;
            --panel:#121214;
            --card:#18181b;
            --accent:#e50914;
            --muted:#9ca3af;
            --glass: rgba(255,255,255,0.03);
            --radius:10px;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }
        html,body{height:100%;margin:0}
        body{
            background: linear-gradient(180deg,#060607 0%, #0b0b0f 100%);
            color:#e6e7ea;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:28px;
        }
        .app{
            width:100%;
            max-width:1100px;
            background:linear-gradient(180deg,var(--panel),#0f0f11);
            border-radius:14px;
            padding:22px;
            box-shadow:0 20px 50px rgba(2,6,23,0.6);
            display:flex;
            flex-direction:column;
            gap:14px;
        }
        header{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            margin-bottom:4px;
        }
        .logo{
            display:flex;
            align-items:center;
            gap:12px;
        }
        .logo .mark{
            width:46px;height:46px;border-radius:6px;background:var(--accent);
            display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:1.05rem;
            box-shadow:0 6px 18px rgba(233,9,20,0.18);
        }
        h1{margin:0;font-size:1.3rem;letter-spacing:0.4px}
        .subtitle{color:var(--muted);font-size:0.95rem;margin-top:4px}
        .searchRow{display:flex;gap:12px;align-items:center;margin:16px 0}
        form{flex:1;display:flex;gap:12px;align-items:center}
        .input{
            flex:1;background:transparent;border:1px solid rgba(255,255,255,0.06);
            padding:12px 14px;border-radius:10px;color:inherit;font-size:1rem;outline:none;
            box-shadow: inset 0 -1px 0 rgba(255,255,255,0.02);
        }
        .btn{
            background:var(--accent);color:#fff;padding:11px 16px;border-radius:10px;border:0;font-weight:700;cursor:pointer;
            box-shadow:0 8px 24px rgba(233,9,20,0.14);
        }
        .btn[disabled]{opacity:0.6;cursor:wait}
        .chips{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
        .chip{
            background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:999px;color:var(--muted);cursor:pointer;
        }
        .results{
            margin-top:12px;
            display:grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap:14px;
        }
        .tile{
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-radius:10px;
            overflow:hidden;
            height:260px;
            position:relative;
            display:flex;
            flex-direction:column;
            justify-content:flex-end;
            box-shadow:0 8px 24px rgba(2,6,23,0.6);
            border:1px solid rgba(255,255,255,0.03);
        }
        .poster{
            position:absolute;inset:0;background-size:cover;background-position:center;filter:brightness(0.74);
        }
        .tileOverlay{
            position:relative;padding:12px;background:linear-gradient(180deg, transparent 30%, rgba(0,0,0,0.6));
        }
        .title{font-weight:700;margin:0;font-size:0.98rem}
        .meta{color:var(--muted);font-size:0.85rem;margin-top:6px}
        .message{
            position:relative;margin-bottom:12px;padding:10px 12px;border-radius:10px;color:#fff;font-weight:600;
            background:linear-gradient(90deg,var(--accent),#ff6b6b);display:inline-block;
        }
        .message.err{background:linear-gradient(90deg,#7b1f1f,#c02626)}
        .empty{
            color:var(--muted);padding:18px;border-radius:10px;background:rgba(255,255,255,0.02);text-align:center;
        }
        footer{
            margin-top:6px;
            border-top:1px solid rgba(255,255,255,0.06);
            padding-top:10px;
            display:flex;
            align-items:center;
            justify-content:space-between;
            color:var(--muted);
            font-size:0.85rem;
        }
        footer span{
            opacity:0.8;
        }
        footer a{
            color:var(--muted);
            text-decoration:none;
        }
        footer a:hover{
            color:var(--accent);
        }
        @media (max-width:720px){
            .results{grid-template-columns:repeat(auto-fill, minmax(140px,1fr))}
            .tile{height:220px}
            footer{flex-direction:column;gap:6px;text-align:center;}
        }
    </style>
</head>
<body>
    <main class="app" role="main" aria-live="polite">
        <header>
            <div class="logo">
                <div class="mark">R</div>
                <div>
                    <h1>Recommender</h1>
                    <div class="subtitle">Find your next favorite movie</div>
                </div>
            </div>
            <div style="color:var(--muted);font-weight:700">5 recommendations</div>
        </header>

        <div class="searchRow">
            <form id="recForm" autocomplete="off">
                <input id="movieInput" class="input" type="text" placeholder="Search a movie (e.g., Inception)" required />
                <button class="btn" id="sendBtn" type="submit">Show recommendations</button>
            </form>

            <div style="margin-left:12px">
                <div class="chips">
                    <button class="chip" id="sample1">Inception</button>
                    <button class="chip" id="sample2">Amélie</button>
                    <button class="chip" id="sample3">The Matrix</button>
                </div>
            </div>
        </div>

        <div id="notification"></div>

        <section class="results" id="results">
            <div class="empty">Enter a title and search to get recommendations.</div>
        </section>

        <footer>
            <span>POC — Dataset: <strong>TMDB 5000 Movies (Kaggle)</strong>. Recommendations generated via <strong>TF-IDF</strong> + <strong>KNN (cosine similarity)</strong>.</span>
            <span>Made with Flask • scikit-learn</span>
        </footer>
    </main>

    <script>
        const form = document.getElementById('recForm');
        const input = document.getElementById('movieInput');
        const results = document.getElementById('results');
        const sendBtn = document.getElementById('sendBtn');
        const sample1 = document.getElementById('sample1');
        const sample2 = document.getElementById('sample2');
        const sample3 = document.getElementById('sample3');
        const notification = document.getElementById('notification');
        const DEFAULT_COUNT = 5;

        function notify(text, isError=false, timeout=3000){
            notification.innerHTML = '<div class="message'+(isError? ' err':'')+'">'+escapeHtml(text)+'</div>';
            if(timeout>0) setTimeout(()=>{ notification.innerHTML = ''; }, timeout);
        }

        function clearResults(){ results.innerHTML = ''; }

        function makeTile(title, posterUrl){
            const tile = document.createElement('div');
            tile.className = 'tile';
            const poster = document.createElement('div');
            poster.className = 'poster';
            if(posterUrl) poster.style.backgroundImage = `url(${escapeHtml(posterUrl)})`;
            else {
                const initials = (title||'').split(' ').slice(0,2).map(s=>s[0]).join('').toUpperCase() || '?';
                const hue = (title||'').charCodeAt(0) % 360;
                poster.style.backgroundImage = `linear-gradient(135deg,hsl(${hue} 70% 50%), hsl(${(hue+40)%360} 70% 40%))`;
                const initialEl = document.createElement('div');
                initialEl.style.position='absolute';
                initialEl.style.inset='0';
                initialEl.style.display='flex';
                initialEl.style.alignItems='center';
                initialEl.style.justifyContent='center';
                initialEl.style.fontSize='48px';
                initialEl.style.fontWeight='800';
                initialEl.style.color='rgba(255,255,255,0.12)';
                poster.appendChild(initialEl);
                initialEl.textContent = initials;
            }
            tile.appendChild(poster);
            const overlay = document.createElement('div');
            overlay.className = 'tileOverlay';
            overlay.innerHTML = `<div class="title">${escapeHtml(title||'Untitled')}</div>`;
            tile.appendChild(overlay);
            return tile;
        }

        function renderRecommendations(list){
            clearResults();
            if(!Array.isArray(list) || list.length === 0){
                results.innerHTML = '<div class="empty">No recommendations found.</div>';
                return;
            }
            list.slice(0, DEFAULT_COUNT).forEach(item=>{
                let title = '';
                let poster = '';
                if(typeof item === 'string') title = item;
                else if(typeof item === 'object' && item !== null){
                    title = item.title || item.name || item.label || JSON.stringify(item).slice(0,60);
                    if (item.poster || item.image || item.posterUrl || item.poster_url) poster = item.poster || item.image || item.posterUrl || item.poster_url;
                } else title = String(item);
                results.appendChild(makeTile(title, poster));
            });
        }

        form.addEventListener('submit', async (e)=>{
            e.preventDefault();
            const movie = input.value.trim();
            if(!movie) return;
            sendBtn.disabled = true;
            notify('Searching...');
            try{
                const res = await fetch('/recommend', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: movie, n: DEFAULT_COUNT })
                });
                const ct = res.headers.get('content-type') || '';
                if(!res.ok){
                    const txt = await res.text();
                    notify('Error: ' + (txt || res.statusText), true);
                } else if (ct.includes('application/json')){
                    const data = await res.json();
                    let list = Array.isArray(data) ? data : (data.recommendations || data.results || []);
                    renderRecommendations(list);
                    notify('Recommendations ready', false, 1400);
                } else {
                    const txt = await res.text();
                    notify(txt, true);
                }
            }catch(err){
                notify(err.message || 'Network error', true);
            }finally{
                sendBtn.disabled = false;
            }
        });

        sample1.addEventListener('click', ()=> { input.value = "Inception"; input.focus(); });
        sample2.addEventListener('click', ()=> { input.value = "Amélie"; input.focus(); });
        sample3.addEventListener('click', ()=> { input.value = "The Matrix"; input.focus(); });

        function escapeHtml(s){
            return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]);
        }
    </script>
</body>
</html>
